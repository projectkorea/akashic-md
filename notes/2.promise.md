# Promise

## 1. What is `promise`?

-   `Promise` is a built-in Javascript `object` for asynchronous.
-   í”„ë¡œë¯¸ìŠ¤ ê°ì²´ëŠ” ì½œë°±ì§€ì˜¥ì„ í•´ê²°í•˜ê³ , ì—¬ëŸ¬ê°œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.
-   ì •í•´ì§„ ì¥ì‹œê°„ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ê°€,
    -   ì •ìƒì ìœ¼ë¡œ ì‘ë™í–ˆë‹¤ë©´ **ì„±ê³µì˜ ë©”ì„¸ì§€ + ê²°ê³¼ê°’**ì„ ì „ë‹¬í•´ì£¼ê³ ,
    -   ì˜ˆìƒì¹˜ ëª»í•œ ê²°ê³¼ê°€ ë‚˜ì™”ì„ ë•Œ **error**ë¥¼ ì „ë‹¬í•œë‹¤.

    #### í”„ë¡œë¯¸ìŠ¤ì˜ ê¸°ë³¸ êµ¬ì¡°
-  ```js
    new Promise(executor)
    ```
    - `Promise ê°ì²´`ëŠ” `new` í‚¤ì›Œë“œì™€ `Promise` ìƒì„±ìë¥¼ ì‚¬ìš©í•´ ë§Œë“ ë‹¤. 
    - `Promise` ìƒì„±ìëŠ” ë§¤ê°œë³€ìˆ˜ë¡œ executor ë¼ëŠ” **ì½œë°± í•¨ìˆ˜**ë¥¼ ë°›ëŠ”ë‹¤. 
    - `executor`ëŠ” `Promise ê°ì²´`ë¥¼ ë°˜í™˜í•˜ê¸°ë„ ì „ì— **ë°”ë¡œ ì‹¤í–‰**ëœë‹¤.
  - 
    ```js
    const myFirstPromise = new Promise((resolve, reject) => {
    // do something asynchronous which eventually calls either:
    //
    //   resolve(someValue)        // fulfilled
    // or
    //   reject("failure reason")  // rejected
    });
    ```
    
    - `executor`ëŠ” **`resolve` í•¨ìˆ˜** ì™€ **`reject` í•¨ìˆ˜**ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤.

## 2. state, producer / consumer

### 1) state
   1. pending: ê¸°ëŠ¥ ìˆ˜í–‰ì¤‘ì¸ ìƒíƒœ
   2. fulfilled: ì„±ê³µ
   3. rejected: ì‹¤íŒ¨

**fullfilled**
```js
const promise = new Promise(function(resolve, reject){
    resolve('value')
})
promise.then(value=>console.log(value))
```
- ì½œë°± í•¨ìˆ˜ì˜ ì¸ì `resolve()` ë¥¼ ì‹¤í–‰í•˜ë©´ **Fulfilled(ì´í–‰) ìƒíƒœì˜ Promise ê°ì²´ë¥¼ ë¦¬í„´í•œë‹¤**.
- ì´í–‰ ìƒíƒœê°€ ë˜ë©´ `.then()` ì„ ì´ìš©í•˜ì—¬ ì²˜ë¦¬ ê²°ê³¼ ê°’ì„ ë°›ì•„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

**rejected**
```js
new Promise(function(resolve, reject){
    reject(new Error('Error occured!'))
})
promise.catch(err=>console.log(err))
```
- ì½œë°± í•¨ìˆ˜ì˜ ì¸ì `reject()` ë¥¼ ì‹¤í–‰í•˜ë©´ **Rejected(ì‹¤íŒ¨) ìƒíƒœì˜ Promise ê°ì²´ë¥¼ ë¦¬í„´í•œë‹¤**
- ì‹¤íŒ¨ ìƒíƒœê°€ ë˜ë©´ ì‹¤íŒ¨ ì²˜ë¦¬ ê²°ê³¼ ê°’ì„ í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œ `catch()` ë¡œ ë°›ì•„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.


### 2) producer / consumer

  1) producer: `promise` ì˜¤ë¸Œì íŠ¸
  2) consumer
     - `.then()`, `.catch()`, `.finally()`
     - `Promise ê°ì²´`ì˜ ìƒíƒœì— ë”°ë¼ ì²˜ë¦¬ í•  í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œë¥¼ ì¼ì»«ëŠ”ë‹¤.

**Producer ì •ì˜**

```js
const promise = new Promise((resolve, reject) => {
    //doing some heavy work(network, read files)
    console.log('...');
    setTimeout(() => {
        resolve('junha');
    }, 2000);
    reject(new Error('no network'));
});
```

**Consumer ì •ì˜**

```js
promise
    .then((value) => {
        console.log(value);
    })
    .catch((error) => {
        console.log(error);
    })
    .finally(() => {
        console.log('finally');
    });
```
#### `.then(onFulfilled, onRejected);`
- `then` ë©”ì†Œë“œëŠ” ë‘ ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤. 
- ì²« ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” Fulfilled(ì´í–‰, resolve í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ) ì‹œ í˜¸ì¶œë˜ê³ 
- ë‘ ë²ˆì§¸ í•¨ìˆ˜ëŠ” Reject(ì‹¤íŒ¨, reject í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ) ì‹œ í˜¸ì¶œëœë‹¤.
- then ë©”ì†Œë“œëŠ” Promiseë¥¼ ë°˜í™˜í•œë‹¤.

#### `.catch(onRejected);`
- ì˜ˆì™¸(ë¹„ë™ê¸° ì²˜ë¦¬ ë˜ëŠ” then ë©”ì†Œë“œì—ì„œ ë°œìƒí•œ ì—ëŸ¬)ê°€ ë°œìƒí•˜ë©´ í˜¸ì¶œëœë‹¤.
- catch ë©”ì†Œë“œëŠ” Promiseë¥¼ ë°˜í™˜í•œë‹¤.

#### `.finally(onFinally);`
- Promise ê°€ ì²˜ë¦¬ë˜ë©´ ìƒíƒœì— ìƒê´€ì—†ì´ ì§€ì •ëœ ì½œë°± í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤.


## 3. Promise Chaining

- `.then()`, `.catch()`ëŠ” `Promise`ë¥¼ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì— `.then() | .catch()`ë¡œ ì²´ì´ë‹ í•  ìˆ˜ ìˆë‹¤.

**ì˜ˆì‹œ1) ì²´ì´ë‹ ì˜ˆì‹œ ì½”ë“œ**

```js
const fetchNumber = new Promise((resolve, reject) => {
    setTimeout(() => resolve(1), 1000);
});

fetchNumber
    .then((num) => num * 2)
    .then((num) => num * 3)
    .then((num) => {
        return new Promise((resolve, reject) => {
            setTimeout(() => resolve(num - 1), 1000);
        });
    });
    .then(num => console.log(num))
```

**ì˜ˆì‹œ2) ì›¹ ì„œë¹„ìŠ¤ ì¸ì¦ ì½”ë“œ**

```js
var userInfo = {
  id: 'test@abc.com',
  pw: '****'
};

function parseValue() {
  return new Promise({
    // ...
  });
}
function auth() {
  return new Promise({
    // ...
  });
}
function display() {
  return new Promise({
    // ...
  });
}
```
```js
getData(userInfo)
  .then(parseValue)
  .then(auth)
  .then(diaplay);
```
- `.then()`ì´ Promise ê°ì²´ë¥¼ ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì— ì²´ì´ë‹ì´ ê°€ëŠ¥í•˜ë‹¤.


## 4. Error Handling

#### 1) `then()` ì˜ ë‘ë²ˆì§¸ ì¸ìë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•

```js
getData()
    .then(onFullfiled, onRejected);
```

#### 2) `catch()`ë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•

```js
getData()
    .then()
    .catch();
```

```js
getData().catch(function (err) {
  console.log(err);
});

getData().then(undefined, function (err) {
  console.log(err);
});
```
- `catch()`ëŠ” `then(undefined, onRejexted)`ë¥¼ í˜¸ì¶œí•œë‹¤.

#### 3) `.catch()` ì‚¬ìš©ì„ ê¶Œì¥í•œë‹¤.

**ì˜ˆì‹œ) `then()`ì˜ ì²«ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ê²½ìš°**

```js
function getData() {
  return new Promise(function (resolve, reject) {
    resolve("hi");
  });
}
```

```js
getData().then(
  function (result) {
    console.log(result);
    throw new Error("Error in then()");
    // Uncaught (in promise) Error: Error in then()
  },
  function (err) {
    console.log("then error : ", err);
    // this can't caught "Error in then()" Error
  }
);
```
- `then()` ì˜ ì²« ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ê²½ìš° ì¡ì•„ë‚´ì§€ ëª»í•œë‹¤.

```js
getData()
  .then(function (result) {
    console.log(result); // hi
    throw new Error("Error in then()");
  })
  .catch(function (err) {
    console.log("then error : ", err);
    // then error :  Error: Error in then()
  });
```

- `.catch()` ë©”ì†Œë“œë¥¼ ëª¨ë“  `.then()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œ ì´í›„ì— í˜¸ì¶œí•˜ë©´, ë¹„ë™ê¸° ì²˜ë¦¬ì—ì„œ ë°œìƒí•œ ì—ëŸ¬(reject í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ)ë¿ë§Œ ì•„ë‹ˆë¼ then ë©”ì†Œë“œ ì•ˆì—ì„œ ë°œìƒí•œ ì—ëŸ¬ê¹Œì§€ ëª¨ë‘ ìºì¹˜í•  ìˆ˜ ìˆë‹¤.
- ë”°ë¼ì„œ ê°€ë…ì„±ë„ ì¢‹ê³  ë” ë§ì€ ì˜ˆì™¸ ì²˜ë¦¬ ìƒí™©ì„ ìœ„í•´ `catch()` ë¡œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.

#### 4) ì¬ë¯¸ìˆëŠ” ì˜ˆì‹œ

```js
const getHen = () => {
    new Promise((resolve, reject) => {
        setTimeout(() => resolve('ğŸ”'), 1000);
    });
};

const getEgg = (hen) =>
    new Promise((resolve, reject) => {
        setTimeout(() => resolve(`${hen} => 'ğŸ¥š'`), 1000);
    });

const getFry = (egg) =>
    new Promise((resolve, reject) => {
        setTimeout(() => resolve(`${egg} => 'ğŸ¥¯'`), 1000);
    });

getHen()
    .then((hen) => getEgg(hen))
    .catch((error) => {
        return `${egg} => 'ğŸ•'`;
    })
    .then((egg) => getFry(egg))
    .then((meal) => console.log(meal));
```

```js
.then((hen) => getEgg(hen))
.then(getEgg)
// ì•„ê·œë¨¼íŠ¸ê°€ ë™ì¼í•  ê²½ìš° ìƒëµì´ ê°€ëŠ¥í•˜ë‹¤.
```

#### 5) useful promise

##### 1) `Promise.all()`
-   promise ë°°ì—´ì„ ì „ë‹¬í•˜ê²Œ ë˜ë©´, ëª¨ë“  promiseë“¤ì´ ë³‘ë ¬ì ìœ¼ë¡œ ì™„ë£Œë¨ ë•Œ ê¹Œì§€ ë°›ì•„ì¤€ë‹¤.

```js
function pickAllFruites() {
    return Promise.all([getApple(), getBanana()]).then((fruits) =>
        fruits.join('+')
    );
}
pickAllFruits().then(console.log);
```

##### 2) `Promise.race()`
-   `Promise.race([func1(), func2()])`: ë°°ì—´ì—ì„œ ê°€ì¥ ë¨¼ì € returní•˜ëŠ” ê°’ìœ¼ë¡œ ì „ë‹¬í•œë‹¤.

```js
function pickOnlyOne() {
    return Promise.race([getApple(), getBanana()]);
}
pickOnlyOne().then(console.log);
```