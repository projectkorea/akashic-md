# async, await

- **Promise Chaining**ì„ **ë™ê¸°ì ì¸** ì½”ë“œì¸ ê²ƒ ì²˜ëŸ¼ ë§Œë“¤ì–´ì¤€ë‹¤.
- `syntatic sugar`
  - ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ì‘ì„± í¸ì˜ì„±ì„ ë†’ì´ê¸° ìœ„í•´ ì œê³µë˜ëŠ” ë¬¸ë²•ì  ë„êµ¬
  - ì‹¤ì œ ê¸°ëŠ¥ì´ë‚˜ ë™ì‘ì—ëŠ” ë³€í•¨ì„ ì£¼ì§€ ì•Šìœ¼ë©´ì„œë„ ê¸°ì¡´ ê¸°ëŠ¥ì„ ë” ì§ê´€ì ì´ê³  ê°„ê²°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

## 1. async í•¨ìˆ˜

- í•­ìƒ **`Promise`** ë¥¼ ë¦¬í„´í•œë‹¤.
  - `FULFILLED`: `async` í•¨ìˆ˜ì—ì„œ ì˜¤ë¥˜ ì—†ì´ ëë‚  ê²½ìš°
  - `REJECTED`: `async` í•¨ìˆ˜ì—ì„œ ì—ëŸ¬ê°€ ë‚˜ê±°ë‚˜, `Promise.reject()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°

```js
async function fetchUser() {
    // do network request in 10secs
    return 'junha';
}
const user = fetchUser(); // == Promise.resolve('junha')
console.log(user);
```

## 2. await í‚¤ì›Œë“œ

awaitëŠ” Promiseë¥¼ ë°˜í™˜í•˜ëŠ” í‘œí˜„ì‹ ì•ì— ì‚¬ìš©í•œë‹¤.
í•´ë‹¹ Promiseê°€ ì²˜ë¦¬(resolve)ë  ë•Œê¹Œì§€ **ê¸°ë‹¤ë¦° í›„** ê·¸ ê²°ê³¼ê°’ì„ ë°˜í™˜í•œë‹¤.

1. `await`ëŠ” í•´ë‹¹ `Promise`ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ë‹¤ìŒ ì½”ë“œë¡œ ë„˜ì–´ê°€ì§€ ì•Šê²Œ í•œë‹¤.

   ```js
   async function example() {
     console.log('Before');
     await new Promise(resolve => setTimeout(resolve, 1000));
     // Promise ê°ì²´ê°€ ìƒì„±ë¨
     // 1ì´ˆ í›„ì— í•´ë‹¹ PromiseëŠ” resolved ìƒíƒœê°€ ë¨
     console.log('After 1 second');
   }
   ```

2. `await`ëŠ” ë°˜ë“œì‹œ `async function` ì•ˆì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

   ```js
   async function fetchData() {
     const data = await fetch('https://api.example.com/data');
     console.log(data);
   }
   ```

3. `Promise`ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ ì•ì— `await`ë¥¼ ë¶™ì¸ë‹¤.

   ```js
   async function getUser() {
     const user = await fetchUser();  // fetchUser()ì˜ ë°˜í™˜ ê°’ì€ Promise ê°ì²´
     console.log(user);
   }
   ```

4. `await`ë¡œ ë°›ì€ ê°’ì€ Promise ìì²´ê°€ ì•„ë‹Œ, **resolved ê°’**ì´ë‹¤.

   ```js
   async function getNumber() {
     const numberPromise = Promise.resolve(42);
     const number = await numberPromise;  // numberëŠ” 42
     console.log(number);  // ì¶œë ¥: 42
   }
   ```

### ì˜ˆì‹œ) async/awaitì„ ì“°ì§€ ì•Šê³  promise thenë§Œ ì“°ëŠ” ê²½ìš°

```js
function delay(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}

function getApple() {
    return delay(2000).then(() => 'ğŸ');
}

function getBanana() {
    return delay(1000).then(() => 'ğŸŒ');
}

function pickFruits() {
    return getApple().then((apple) => {
        return getBanana().then((banana) => `${apple} + ${banana}`);
    }); // this is hard to read
}

pickFruits().then(console.log);
```

### ì˜ˆì‹œ) async/awaitì„ ì‚¬ìš©í•˜ì—¬ ë™ê¸°ì ìœ¼ë¡œ í‘œí˜„í•œ ê²½ìš°

```js
async function pickFruits() {
    const apple = await getApple(); // 2ì´ˆ ì†Œëª¨
    const banana = await getBanana(); // 1ì´ˆ ì†Œëª¨
    return `${apple}+${banana}`; // ì´ 3ì´ˆ ì†Œëª¨
}

pickFruits().then(console.log);
```

- promiseë³´ë‹¤ ê°„ê²°í•˜ê³  ì§ê´€ì ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

```js
async function effPickFruits() {
    const applePromise = getApple(); // execute immediately
    const bananaPromise = getBanana(); // execute immediately
    const apple = await applePromise; // 2ì´ˆ ì´í•˜ ì†Œëª¨
    const banana = await bananaPromise; 
    // applePromiseë¥¼ ê¸°ë‹¤ë¦´ ë•Œ ì´ë¯¸ ë¦¬í„´ ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ë°”ë¡œ ë„˜ì–´ê°„ë‹¤.
    return `${apple}+${banana}`; // ì´ 2ì´ˆ ì†Œëª¨
}
effPickFruits().then(console.log);
```

## 3. promise ì½”ë“œ => async/await ì½”ë“œ

### Before

```js
function displayUser(){
    fetchUser()
    .then((user)=>{
        fetchProfile(user)//
        .then((profile))=>{
            updateUI(user,profile)
        }
    })
}
```

### After

```js
async function displayUser() {
    const user = await fetchUser();
    const profile = await fetchProfile(user);
    updateUI(user, profile);
}
```

## 4. ë¹„ë™ê¸° ì½”ë“œë¥¼ ë™ê¸°ì²˜ëŸ¼ ì‘ë™í•˜ê²Œ í•˜ëŠ” ì˜ˆì‹œ 

### Before

```js
function timer(time) {
  return new Promise(function (resolve) {
    setTimeout(function () {
      resolve(time);
    }, time);
  });
}

timer(1000).then(() => console.log('then ì‹¤í–‰'));
console.log('ë‚˜ëŠ” ì–´ë””ìˆì„ê¹Œ');

// ë‚˜ëŠ” ì–´ë””ìˆì„ê¹Œ
// (1ì´ˆ í›„)
// then ì‹¤í–‰
```

### After

```js
async function init() {
  await timer(1000).then(() => console.log('then ì‹¤í–‰'));
  console.log('ë‚˜ëŠ” ì–´ë””ìˆì„ê¹Œ');
}

function timer(time) {
  return new Promise(function (resolve) {
    setTimeout(function () {
      resolve(time);
    }, time);
  });
}

init()

// (1ì´ˆ í›„)
// then ì‹¤í–‰
// ë‚˜ëŠ” ì–´ë””ìˆì„ê¹Œ
```

- ë¹„ë™ê¸° ì½”ë“œë¥¼ ë™ê¸°ì²˜ëŸ¼ ì‘ë™í•˜ê²Œ í•˜ëŠ” ë§ˆë²•ì€ ì—†ë‹¤,
- **ë™ê¸° ì½”ë“œë¥¼ ë¹„ë™ê¸° ì½”ë“œ ë¸”ëŸ­ì•ˆì—ì„œ** ì‹¤í–‰ì‹œì¼œì•¼í•œë‹¤.

## 5. try catch in async/await

- ë¹„ë™ê¸° ì½”ë“œì˜ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ê²½ìš° try-catch êµ¬ë¬¸ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```javascript
async function fetchData() {
  try {
    const response = await fetch('https://api.example.com/data');
    
    // HTTP ì‘ë‹µ ìƒíƒœê°€ 200ì´ ì•„ë‹Œ ê²½ìš° ì—ëŸ¬ë¥¼ ë˜ì§
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }

    const data = await response.json();
    console.log('Data:', data);
  } catch (error) {
    // ì—ëŸ¬ ì²˜ë¦¬
    console.error('Error fetching data:', error.message);
  }
}

fetchData();
```

- `await`ë¡œ ë¹„ë™ê¸° ìš”ì²­ì„ ì²˜ë¦¬í•  ë•Œ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- ì´ëŸ° ê²½ìš°ì—ëŠ” `try` ë¸”ë¡ìœ¼ë¡œ ê°ì‹¸ì„œ ì—ëŸ¬ë¥¼ ê°ì§€í•˜ê³  `catch` ë¸”ë¡ì—ì„œ ì²˜ë¦¬í•œë‹¤.
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë‚˜ ì‘ë‹µ ìƒíƒœì— ë”°ë¥¸ ì˜ˆì™¸ ì²˜ë¦¬ë„ ê°€ëŠ¥í•˜ë©°, ëª¨ë“  ì¢…ë¥˜ì˜ ì—ëŸ¬ë¥¼ ì¡ì„ ìˆ˜ ìˆë‹¤.
